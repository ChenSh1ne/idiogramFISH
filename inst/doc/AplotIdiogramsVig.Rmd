---
title: "1. Plotting monocentric chromosomes"
author: "Fernando Roa"
date: "23 08 2019"
# pkgdown:
  # as_is: true
output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
    toc: true
    # toc_float: true
    toc_depth: 1
    number_sections: true
# pando_args:
# -  \setcounter{section}{2}
bibliography: [allrefs.bib]
csl: climaMod.csl
link-citations: yes
resource_files:
  - mydfChrSize.svg
  - jquery.min.js
  - clipboard.min.js
  - all.minMod.css
  - bootstrap.minO.css
  - bootstrap.min.js
  - pkgdown2.js
  - fonts/fa-regular-400.svg
  - fonts/fa-regular-400.eot
  - fonts/fa-regular-400.ttf
  - fonts/fa-regular-400.woff
  - fonts/fa-regular-400.woff2
  
vignette: >
  %\VignetteIndexEntry{1. Plotting monocentric chromosomes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

``` {r, results="asis", echo=FALSE, message=FALSE}
# <!-- pkgdown --> 
# <!-- jquery --><script src="jquery.min.js" crossorigin="anonymous"></script>
myfile<-"jquery.min.js"
if(file.exists(myfile)){
cat(paste0('<script src="',myfile,'" crossorigin="anonymous"></script> <!-- # -->'))
}
# <!-- clipboard.js --><script src="clipboard.min.js"  crossorigin="anonymous"></script>
myfile<-"clipboard.min.js"
if(file.exists(myfile)){
cat(paste0('<script src="',myfile,'"crossorigin="anonymous"></script>'))
}
# <!-- Font Awesome icons --><link rel="stylesheet" href="all.minMod.css"  crossorigin="anonymous">
myfile<-"all.minMod.css"
if(file.exists(myfile)){
cat(paste0('<link rel="stylesheet" href="',myfile,'"  crossorigin="anonymous">'))
}
# <!-- Bootstrap --><link rel="stylesheet" href="bootstrap.minO.css" crossorigin="anonymous">
myfile<-"bootstrap.minO.css"
if(file.exists(myfile)){
cat(paste0('<link rel="stylesheet" href="',myfile,'"  crossorigin="anonymous">'))
}
# <!-- # <script src="bootstrap.min.js"  crossorigin="anonymous"></script> -->
myfile<-"bootstrap.min.js"
if(file.exists(myfile)){
cat(paste0('<script src="',myfile,'" crossorigin="anonymous"></script> <!-- # -->'))
}
myfile<-"pkgdown2.js"
if(file.exists(myfile)){
cat(paste0('<script src="',myfile,'"></script> <!-- # -->'))
}
```
<link rel="stylesheet" href="mystyle.css">

<div class="goright">
Go to [home](index.html)  
Go to [2. holocentrics Vignette](BplotIdiogramsHoloVig.html)  
Go to [3. groups Vignette](CgroupsVig.html)  
Go to [4. phylogeny Vignette](DphylogenyVig.html)  
Go to [5. human Vignette](EhumanVig.html)    
<!-- # there are 2 spaces at the end of those lines -->
</div>

This guide shows the files to plot idiograms of measured karyotypes and optionally marks. 

# Load package

visit gitlab for installation instructions https://gitlab.com/ferroao/idiogramFISH

```{r, results="hide", message=FALSE, warning=FALSE, eval=TRUE}

#load package
library(idiogramFISH) 
```

# Get your chromosome size data

Initially you have to open your chromosome data as a data.frame. 

## From scratch: {-}


```{r}
# Example data.frame written in R, use: (column OTU is optional if only 1 OTU)
mydfChrSize<-read.table(text=
"            OTU chrName shortArmSize longArmSize 
1 \"Species one\"   1     1.5         2.0  
2 \"Species one\"   2     2.0         2.5  
3 \"Species one\"   3     1.0         1.5
4 \"Species one\"   X     2.0         3.5"  ,  header=TRUE, stringsAsFactors=FALSE,fill=TRUE)
```

<div class="verysmall">
```{r, echo=F}
# just to show it here
kableExtra::kable_styling(knitr::kable(mydfChrSize) , full_width = F
                           , font_size = 10)
```
</div>

## loading saved data: {-}

Initially, if you use RStudio, use menu "Session", "Set working directory" for choosing your desired folder or:
``` {r, eval=FALSE}
setwd("~/folder/subfolder")
```

Open your chromosome data data.frame importing it from a .csv (read.csv) or .xls file (readxl). 
``` {r, eval=FALSE}
mydfChrSize<-read.csv("somefile.csv")
```

For fixing column names use:
``` {r, eval=FALSE}
colnames(mydfChrSize)<-c("OTU", "chrName","shortArmSize","longArmSize")
```

# Get marks general data

This data.frame is optional for ver. > 1.0.0

``` {r, eval=FALSE}
packageVersion("idiogramFISH")
```

Open or make your mark data as a data.frame. This data.frame has the marks present in all karyotypes without position info.
If `style` column is not present it will be filled with `square` during plotting.

```{r}
# From scratch:
mydfMarkColor<-read.table(text=
"  markName markColor  style
1       5S       red   dots
2      45S     green square
3     DAPI      blue square
4      CMA    yellow square"  ,  header=TRUE, stringsAsFactors=FALSE,fill=TRUE)
```


<div class="verysmall">
```{r, echo=F}
# just to show it here
kableExtra::kable_styling(knitr::kable(mydfMarkColor) , full_width = F
                           , font_size = 10
                          # , bootstrap_options = c("striped", "hover", "condensed") 
                          )
```
</div>

For fixing column names use:
``` {r, eval=FALSE}
colnames(mydfMarkColor)<-c("markName", "markColor","style") 
# if style column is not present it will be filled with "square"
```
# Get marks positions data

Open or write your mark positions as a data.frame. This data.frame has the marks present in all karyotypes with position info.

```{r}
# We will use column OTU if data.frame because chromosome size df has it
mydfOfMarks<-read.table(text=
"            OTU chrName markName markArm markSize markDistCen
1 \"Species one\"      1       5S       p      0.5         0.5
2 \"Species one\"      1      45S       q        1         0.5
3 \"Species one\"      X      45S       p        1         1.0
4 \"Species one\"      3     DAPI       q        1         1.0"  ,  header=TRUE, stringsAsFactors=FALSE,fill=TRUE)
```


<div class="verysmall">
```{r, echo=F}
kableExtra::kable_styling(knitr::kable(mydfOfMarks) , full_width = F
                           , font_size = 10
                          , bootstrap_options = c("striped", "hover", "condensed")
                          )
```
</div>

For fixing column names use something like:
``` {r, eval=FALSE}
colnames(mydfMarkColor)<-c("OTU", "chrName","markName","markArm","markSize","markDistCen") 
```

# Special data.frame for centromeric marks' data

Open or make your mark data as a data.frame. This data.frame has the centromeric marks present in all karyotypes.
Only for `centromereSize >0`.

```{r}
# We will use column OTU because data.frame of chromosome size has it
mydfOfCenMarks<-read.table(text=
"             OTU chrName markName
1  \"Species one\"     1     DAPI
2  \"Species one\"     X      CMA"  ,  header=TRUE, stringsAsFactors=FALSE,fill=TRUE)
```

<div class="verysmall">
```{r, echo=F}
kableExtra::kable_styling(knitr::kable(mydfOfCenMarks) , full_width = F
                           , font_size = 10
                          , bootstrap_options = c("striped", "hover", "condensed")
                          )
```
</div>
# Plotting

You can plot without marks (use only 1st data.frame), but we will use all 4 data.frames created.
By default the function will calculate indices and morphological categories [@Guerra1986d;@Levan1964;@Zarco1986new;@Watanabe1999].
Use parameters of the function to modify that. See ?plotIdiograms

```{r example_M1, echo=TRUE, results="hide", fig.width=7, fig.height=4.5, message=FALSE,dev='svg'}
# fig.width=7, fig.height=4.5

svg("mydfChrSize.svg",width=13,height=8 )
# png("mydfChrSize.png", width=600, height=400)
plotIdiograms(dfChrSize=mydfChrSize,      # chr. size data.frame
              dfMarkPos=mydfOfMarks,      # mark position df (not cen.)
              dfCenMarks=mydfOfCenMarks,  # cen. marks df
              dfMarkColor=mydfMarkColor,  # mark style df
              roundness=3,                # vertices roundness  
              dotRoundCorr=2.5,           # correction of roundness of dots 
              
              chrWidth=4.5,               # width of chr.
              chrSpacing = 4,             # space among chr.
              karHeiSpace=1.6,            # vertical size of karyotype including spacer
              
              indexIdTextSize=1,         # font size fo chr name and indices
              OTUTextSize=1.2,             # font size of OTUs
              markLabelSize=1,           # font size of mark legends
              
              rulerPos=-1.9,              # ruler position
              ruler.tck=-0.02,            # ticks of ruler size and orientation
              rulerNumberPos=.5,          # position of numbers in ruler
              rulerNumberSize=1,         # font size of ruler numbers
              
              ylimBotMod = 0.4,           # modify ylim bottom argument
              ylimTopMod = 0              # modify ylim top argument
              
              # ,xlimRightMod = 12
              # ,legend="aside"           # <- TRY THIS
              # ,legendWidth = 1.2
              # ,markLabelSpacer = 4
)
dev.off()
```
  
```{r, results="asis", comment=NA, echo=FALSE}
# cat(paste0("![](mydfChrSize.png)" ) )
cat(paste0("![](mydfChrSize.svg)" ) )
```

After v. 1.1.0, vertices when `centromereSize=0` are rounded:

```{r example_M1cen0, echo=TRUE, results="hide", fig.width=7, fig.height=4.5, message=FALSE,dev='svg'}
# fig.width=7, fig.height=4.5

png("mydfChrSize2.png", width=600, height=400)
plotIdiograms(dfChrSize=mydfChrSize,      # chr. size df
              dfMarkPos=mydfOfMarks,      # mark position df (not cen.)
              dfMarkColor=mydfMarkColor,  # mark style df

              # dfCenMarks=mydfOfCenMarks,# cen. marks df, NOT AVAILABLE FOR centromereSize = 0
              centromereSize = 0,         # <- HERE
              
              roundness=3,                # vertices roundness  
              dotRoundCorr=2.5,           # correction of roundness of dots 
              chrWidth=4.5,               # width of chr.
              chrSpacing = 4,             # space among chr.
              karHeiSpace=1.6,            # vertical size of karyotype including spacer
              indexIdTextSize=.7,         # font size fo chr name and indices
              OTUTextSize=.7,             # font size of OTUs
              markLabelSize=.7,           # font size of mark legends
              rulerPos=-1.9,              # ruler position
              ruler.tck=-0.02,            # ticks of ruler size and orientation
              rulerNumberPos=.5,          # position of numbers in ruler
              rulerNumberSize=.7,         # font size of ruler numbers
              ylimBotMod = 0.4,           # modify ylim bottom argument
              ylimTopMod = 0              # modify ylim top argument
              
              # ,markLabelSpacer=5
              # ,xlimRightMod = 16        #   TRY THIS
              # ,legend="aside"
              # ,legendWidth = 1.5
)
dev.off()
```

```{r, results="asis", comment=NA, echo=FALSE}
cat(paste0("![](mydfChrSize2.png)" ) )
```
  
For ver. > 1.0.0 there is no need to add `dfMarkColor` and you can also use the parameter
`mycolors` (optional too), to establish marks' colors. Colors are assigned depending on the order of marks, i.e.:

``` {r, eval=FALSE}
unique(c(dfOfMarks$markName,dfOfCenMarks$markName) )
```

``` {r, eval=FALSE,dev='svg'}

charVectorCol <- c("tomato3","darkolivegreen4","dfsd","blue","green")
png("dfOfChrSize.png", width=600, height=400)
par(mar=rep(0,4))
plotIdiograms(dfChrSize = dfOfChrSize,     # d.f. of chr. sizes
              dfMarkPos = dfOfMarks,       # d.f. of marks' positions
              chrColor  = "gray",          # chr. color
              cenColor  = "gray",          # cen. color
              dfCenMarks= dfOfCenMarks,    # marks in centromeres
              
              mycolors = charVectorCol,    # colors to use
              
              OTUTextSize = 1,             # font size for OTU names
              dotRoundCorr=2,              # correction of roundness of vert. and dots
              chrWidth=2.5,                # rel. chr. width
              chrSpacing = 2.5,            # rel. horizontal chr. spacing
              karHeiSpace=1.6,             # karyotype height including spacing
              indexIdTextSize=1,           # font size for chr. indexes and chr. name
              markLabelSize=1,             # font size for labels (legend)
              
              rulerPos=-1.9,               # ruler position
              ruler.tck=-0.02,             # ruler tick orientation and length
              rulerNumberPos=.5,           # rulers' numbers position
              rulerNumberSize=1            # ruler font size
)
dev.off()
```


# Example with several species (OTUs)

## To illustrate this, we will load some data.frames from the package {-}

``` Chromosome sizes```
```{r}
data(bigdfOfChrSize)
```

<div class="verysmall">
```{r, echo=F}
# kableExtra::scroll_box(height = "300px", width="400px",
           # kableExtra::add_header_above(
                            kableExtra::kable_styling(knitr::kable(bigdfOfChrSize) , full_width = F
                           , font_size = 10
                          , bootstrap_options = c("striped", "hover", "condensed"),
                 
) 
# ) 
# )
```
</div>

``` Mark characteristics, optional for ver. > 1.0.0, does not require OTU  ```
```{r}
data(bigdfOfMarks)
```
<div class="verysmall">
```{r, echo=F}
kableExtra::kable_styling(knitr::kable(dfMarkColor) , full_width = F
                           , font_size = 10
                          , bootstrap_options = c("striped", "hover", "condensed")
                          )
```
</div>

```Mark position```
```{r}
data("bigdfOfMarks")
```
<div class="verysmall">
```{r, echo=F}
kableExtra::kable_styling(knitr::kable(bigdfOfMarks) , full_width = F
                           , font_size = 10
                          , bootstrap_options = c("striped", "hover", "condensed")
                          )
```
</div>


```Centromeric Marks only```
```{r}
data("bigdfDataCen")
```
<div class="verysmall">
```{r, echo=F}
kableExtra::kable_styling(knitr::kable(bigdfDataCen) , full_width = F
                           , font_size = 10
                          , bootstrap_options = c("striped", "hover", "condensed")
                          )
```
</div>

## Plotting {-}

```{r example_M3, echo=TRUE, results="hide", fig.width=6, fig.height=13, message=FALSE,dev='svg'}
# fig.width=6, fig.height=13
png("bigdfOfChrSize.png", width=450, height=900)
plotIdiograms(dfChrSize  =bigdfOfChrSize,# chr sizes
              dfMarkColor=dfMarkColor,   # mark characteristics, optional in dev version. see above. 
              dfMarkPos  =bigdfOfMarks,  # mark positions (no cen. marks)
              dfCenMarks =bigdfDataCen,  # cen. marks df
              karHeight=1.2,             # karyotype rel. height
              karHeiSpace=2.2,           # karyotype vertical size with spacing
              karSepar = TRUE,           # modify vertical separation of kar.
              amoSepar = 1.2,            # Vertical separation of kar. when karSpear = TRUE
              
              dotRoundCorr = .5,         # correction factor for dot marks
              distTextChr=.5,            # distance of chr. to text
              indexIdTextSize=.7,        # font size of indices and chr. name
              OTUTextSize=.9,            # font size of OTU names
              legend="aside",            # position of legend not "inline"
              markLabelSize=.7,          # font size of legend
              markLabelSpacer=1,         # distance from chr. to legend
              morpho=FALSE,              # add chr. morphology
              
              ruler=TRUE,                # add ruler
              rulerPos=-.9,              # position of ruler
              rulerPosMod=3,             # modify position of ruler
              ruler.tck=-0.004,          # size and orient. of ticks in ruler
              rulerNumberPos=.4,         # position of numbers of ruler
              rulerNumberSize=.4,        # font size of ruler
              
              xlimRightMod=2,            # modify xlim right argument
              ylimBotMod = 0,            # modify ylim bottom argument
              ylimTopMod = -.3,          # modify ylim top argument
              )
dev.off()
```
```{r, results="asis", comment=NA, echo=FALSE}
cat(paste0("![](bigdfOfChrSize.png)" ) )
```
`r if (knitr:::is_html_output()) '
# References {-}
'`

